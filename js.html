<!-- Archivo de JS -->
<script>
  // Constantes
  const NOTIFICACION_OK = 1
  const NOTIFICACION_DANGER = 2
  const NOTIFICACION_WARNING = 3

  function crearTablaContactos() {
    google.script.run
      .withSuccessHandler(crearTablaContactosCorrectamente)
      .withFailureHandler(crearTablaContactosError)
      .obtenerContactos();
  }

  function crearTablaContactosCorrectamente(obj) {
    // Creamos una tabla con HTML
    let tabla = document.createElement("table");
    let tablaBody = document.createElement("tbody");
    let tablaHeader = document.createElement("thead");

    Array.from(obj).forEach((filaActual, i) => {
      let fila = document.createElement("tr");

      filaActual.forEach((celdaActual) => {
        let celda;
        if (i === 0) {
          celda = document.createElement("th"); // Primera fila como encabezado
        } else {
          celda = document.createElement("td");
        }
        celda.textContent = celdaActual;
        fila.appendChild(celda);
      });

      if (i === 0) {
        tablaHeader.appendChild(fila); // Agregar fila al encabezado
      } else {
        tablaBody.appendChild(fila); // Agregar fila al cuerpo
      }
    });

    // Agregar el encabezado y cuerpo a la tabla
    tabla.appendChild(tablaHeader);
    tabla.appendChild(tablaBody);

    // Agregar clases a la cabecera
    tablaHeader.classList.add("table-dark");

    // Agregar clases a la tabla
    tabla.classList.add(
      "table",
      "table-striped",
      "border",
      "border-4",
      "border-dark",
      "table-success"
    );

    // Insertar la tabla en el DOM
    let contenedor = document.getElementById("divContactos");
    contenedor.innerHTML = ""; // Limpiar contenido previo
    contenedor.appendChild(tabla);

    // Mostrar notificación de éxito
    crearNotificacion(NOTIFICACION_OK, "Contactos obtenidos correctamente", "Éxito");
  }

  function crearTablaContactosError() {
    // Mostrar notificación de error
    crearNotificacion(NOTIFICACION_DANGER, "Error al obtener los contactos", "Error");
  }

  function crearNotificacion(tipo, mensaje, titulo) {
    // Obtener datos
    let mensajeNotificacion = document.getElementById("mensajeNotificacion");
    let tituloNotificacion = document.getElementById("tituloNotificacion");
    let elementoNotificacion = document.getElementById("notificacion");
    let iconoNotificacion = document.getElementById("icono-notificacion");
    let notificacion = bootstrap.Toast.getOrCreateInstance(elementoNotificacion);

    // Establecer mensaje y título
    mensajeNotificacion.textContent = mensaje;
    tituloNotificacion.textContent = titulo;

    // Definir estilos según el tipo de notificación
    switch(tipo) {
      case NOTIFICACION_OK:
        iconoNotificacion.className = "";
        elementoNotificacion.classList.add("bi", "bi-check2-square");
        elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue("--color-verde-oscuro");
        break;

      case NOTIFICACION_DANGER:
        iconoNotificacion.className = "";
        elementoNotificacion.classList.add("bi", "bi-bug");
        elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue("--color-rojo-oscuro");
        break;

      case NOTIFICACION_WARNING:
        iconoNotificacion.className = "";
        elementoNotificacion.classList.add("bi", "bi-exclamation-square");
        elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue("--color-amarillo-oscuro");
        break;
    }



    // Mostrar la notificación
    notificacion.show();
  }
</script>

<!-- Contenedor donde se insertará la tabla -->
<button onclick="crearTablaContactos()">Cargar Contactos</button>
